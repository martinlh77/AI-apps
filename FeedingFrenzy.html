<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feeding Frenzy - Because Real Fish Are Too Much Work</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Comic Sans MS', cursive;
            background: linear-gradient(to bottom, #001a33, #003d5c);
            color: white;
            overflow: hidden;
            user-select: none;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        #tank {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: calc(100vh - 80px);
            background: linear-gradient(to bottom, #1a4d6d, #0a2a3d);
            overflow: hidden;
            box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.5);
            cursor: crosshair;
            background-size: cover;
            background-position: center;
        }
        
        #hud {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 15px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            font-size: 14px;
        }
        
        .stat {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
        }
        
        .coin-icon {
            color: gold;
            font-size: 18px;
        }
        
        #controls {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }
        
        #pauseBtn, #bgBtn {
            padding: 8px 15px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #5aa3ff;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.2s;
        }
        
        #pauseBtn:hover, #bgBtn:hover {
            background: rgba(30, 30, 30, 0.9);
            transform: scale(1.05);
        }
        
        #shop {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.95);
            padding: 10px;
            border-radius: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            z-index: 1000;
            max-width: 100%;
            margin: 0;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.5);
        }
        
        .shop-btn {
            padding: 8px 12px;
            background: linear-gradient(to bottom, #4a90e2, #2a5f9e);
            border: 2px solid #5aa3ff;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
            white-space: nowrap;
        }
        
        .shop-btn:hover:not(:disabled) {
            transform: scale(1.05);
            background: linear-gradient(to bottom, #5aa3ff, #3a7fbe);
            box-shadow: 0 0 15px rgba(90, 163, 255, 0.5);
        }
        
        .shop-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .fish, .crab, .jellyfish {
            position: absolute;
            transition: transform 0.3s;
            z-index: 10;
            cursor: pointer;
        }
        
        .fish {
            font-size: 30px;
        }
        
        .crab {
            font-size: 28px;
        }
        
        .jellyfish {
            font-size: 32px;
        }
        
        .pellet {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #ff9d4d, #ff6b35);
            border-radius: 50%;
            z-index: 5;
            box-shadow: 0 0 5px rgba(255, 157, 77, 0.8);
        }
        
        .coin, .diamond {
            position: absolute;
            font-size: 32px;
            z-index: 15;
            cursor: pointer;
            animation: sparkle 1s infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { filter: brightness(1); transform: scale(1); }
            50% { filter: brightness(1.5); transform: scale(1.1); }
        }
        
        .bubble {
            position: absolute;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1));
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1;
        }
        
        .death-msg {
            position: absolute;
            color: #ff4444;
            font-size: 16px;
            font-weight: bold;
            z-index: 20;
            animation: fadeUp 1s ease-out forwards;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            pointer-events: none;
        }
        
        @keyframes fadeUp {
            to {
                opacity: 0;
                transform: translateY(-30px);
            }
        }
        
        #bgModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 20px;
            border-radius: 15px;
            z-index: 2000;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        #bgModal h2 {
            margin-bottom: 15px;
            text-align: center;
        }
        
        .bg-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .bg-option {
            cursor: pointer;
            border: 3px solid transparent;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.2s;
        }
        
        .bg-option:hover {
            border-color: #5aa3ff;
            transform: scale(1.05);
        }
        
        .bg-option img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            display: block;
        }
        
        .modal-btn {
            padding: 10px 20px;
            background: linear-gradient(to bottom, #4a90e2, #2a5f9e);
            border: 2px solid #5aa3ff;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
        }
        
        #fishSelectModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px;
            border-radius: 15px;
            z-index: 2000;
            text-align: center;
            border: 3px solid #5aa3ff;
        }
        
        #fishSelectModal h2 {
            margin-bottom: 20px;
        }
        
        .fish-option {
            font-size: 60px;
            cursor: pointer;
            display: inline-block;
            margin: 10px;
            transition: all 0.2s;
            padding: 10px;
            border: 3px solid transparent;
            border-radius: 10px;
        }
        
        .fish-option:hover {
            transform: scale(1.2);
            filter: drop-shadow(0 0 10px rgba(90, 163, 255, 0.8));
            border-color: #5aa3ff;
            background: rgba(90, 163, 255, 0.2);
        }
        
        .fish-option:active {
            transform: scale(1.1);
        }
        
        .fish-price {
            display: block;
            font-size: 14px;
            color: gold;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            #hud {
                font-size: 12px;
                padding: 8px 12px;
            }
            
            #tank {
                height: calc(100vh - 90px);
            }
            
            #shop {
                grid-template-columns: repeat(2, 1fr);
                font-size: 11px;
                padding: 8px;
            }
            
            .shop-btn {
                padding: 6px 8px;
                font-size: 10px;
            }
            
            .fish {
                font-size: 25px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="tank"></div>
        
        <div id="hud">
            <div class="stat">
                <span class="coin-icon">üí∞</span>
                <span id="coins">50</span>
            </div>
            <div class="stat">
                üêü <span id="fishCount">0</span>
            </div>
            <div class="stat">
                üçî <span id="foodCount">10</span>
            </div>
        </div>
        
        <div id="controls">
            <button id="pauseBtn" onclick="togglePause()">‚è∏Ô∏è</button>
            <button id="bgBtn" onclick="openBgModal()">üñºÔ∏è</button>
        </div>
        
        <div id="shop">
            <button class="shop-btn" onclick="buyFood()" id="buyFoodBtn">
                üçî Food (10üí∞)
            </button>
            <button class="shop-btn" onclick="showFishSelect()" id="buySmallFishBtn">
                üê† Fish (20üí∞)
            </button>
            <button class="shop-btn" onclick="buyFish('predator')" id="buyPredatorBtn">
                ü¶à Predator (100üí∞)
            </button>
            <button class="shop-btn" onclick="buyCollector('crab')" id="buyCrabBtn">
                ü¶Ä Crab (150üí∞)
            </button>
            <button class="shop-btn" onclick="buyCollector('jellyfish')" id="buyJellyfishBtn">
                ü™º Jellyfish (250üí∞)
            </button>
        </div>
    </div>

    <div id="bgModal">
        <h2>üé® Choose Background</h2>
        <div class="bg-grid">
            <div class="bg-option" onclick="setBackground('default')">
                <div style="width:100%;height:100px;background:linear-gradient(to bottom, #1a4d6d, #0a2a3d);display:flex;align-items:center;justify-content:center;color:white;">Default</div>
            </div>
            <div class="bg-option" onclick="setBackground('https://enter.pollinations.ai/api/generate/image/cartoonish%20coral%20reef?model=zimage&seed=6331672&private=true&nologo=true&enhance=true&safe=true&nofeed=true&guidance_scale=7&width=1600&height=1024&quality=medium&transparent=false')">
                <img src="https://enter.pollinations.ai/api/generate/image/cartoonish%20coral%20reef?model=zimage&seed=6331672&private=true&nologo=true&enhance=true&safe=true&nofeed=true&guidance_scale=7&width=1600&height=1024&quality=medium&transparent=false" alt="Coral Reef 1">
            </div>
            <div class="bg-option" onclick="setBackground('https://enter.pollinations.ai/api/generate/image/cartoonish%20coral%20reef?model=zimage&seed=954191603&private=true&nologo=true&enhance=true&safe=true&nofeed=true&guidance_scale=7&width=1600&height=1024&quality=medium&transparent=false')">
                <img src="https://enter.pollinations.ai/api/generate/image/cartoonish%20coral%20reef?model=zimage&seed=954191603&private=true&nologo=true&enhance=true&safe=true&nofeed=true&guidance_scale=7&width=1600&height=1024&quality=medium&transparent=false" alt="Coral Reef 2">
            </div>
            <div class="bg-option" onclick="setBackground('https://enter.pollinations.ai/api/generate/image/cartoonish%20sea%20floor?model=zimage&seed=754697851&private=true&nologo=true&enhance=true&safe=true&nofeed=true&guidance_scale=7&width=1600&height=1024&quality=medium&transparent=false')">
                <img src="https://enter.pollinations.ai/api/generate/image/cartoonish%20sea%20floor?model=zimage&seed=754697851&private=true&nologo=true&enhance=true&safe=true&nofeed=true&guidance_scale=7&width=1600&height=1024&quality=medium&transparent=false" alt="Sea Floor 1">
            </div>
            <div class="bg-option" onclick="setBackground('https://enter.pollinations.ai/api/generate/image/cartoonish%20sea%20floor?model=zimage&seed=405693529&private=true&nologo=true&enhance=true&safe=true&nofeed=true&guidance_scale=7&width=1600&height=1024&quality=medium&transparent=false')">
                <img src="https://enter.pollinations.ai/api/generate/image/cartoonish%20sea%20floor?model=zimage&seed=405693529&private=true&nologo=true&enhance=true&safe=true&nofeed=true&guidance_scale=7&width=1600&height=1024&quality=medium&transparent=false" alt="Sea Floor 2">
            </div>
        </div>
        <input type="file" id="bgUpload" accept="image/*" style="display:none;" onchange="uploadBackground(event)">
        <button class="modal-btn" onclick="document.getElementById('bgUpload').click()">üìÅ Upload Image</button>
        <button class="modal-btn" onclick="closeBgModal()">Close</button>
    </div>

    <div id="fishSelectModal">
        <h2>Choose Your Fish!</h2>
        <p style="color: #aaa; margin-bottom: 15px;">Click fish to buy (20üí∞ each) ‚Ä¢ Buy as many as you want!</p>
        <div>
            <div class="fish-option" onclick="selectFish('üêü')">
                üêü
                <span class="fish-price">20üí∞</span>
            </div>
            <div class="fish-option" onclick="selectFish('üê†')">
                üê†
                <span class="fish-price">20üí∞</span>
            </div>
            <div class="fish-option" onclick="selectFish('üê°')">
                üê°
                <span class="fish-price">20üí∞</span>
            </div>
        </div>
        <div style="margin-top: 20px; color: #5aa3ff; font-size: 16px;">
            üí∞ <span id="modalCoins">50</span> coins
        </div>
        <button class="modal-btn" onclick="closeFishSelect()" style="margin-top:20px;">Close</button>
    </div>

    <script>
        // Audio Context for sound effects
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();
        
        function playSound(type) {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            switch(type) {
                case 'buy':
                    oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.1);
                    break;
                case 'death':
                    oscillator.frequency.setValueAtTime(400, audioCtx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.3);
                    break;
                case 'collect':
                    oscillator.frequency.setValueAtTime(600, audioCtx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.05);
                    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.05);
                    break;
                case 'food':
                    oscillator.frequency.setValueAtTime(300, audioCtx.currentTime);
                    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
                    oscillator.start(audioCtx.currentTime);
                    oscillator.stop(audioCtx.currentTime + 0.05);
                    break;
            }
        }
        
        // Game state
        let coins = 50;
        let food = 10;
        let fishId = 0;
        let pelletId = 0;
        let coinId = 0;
        let isPaused = false;
        let selectedFishEmoji = 'üê†';
        let gameTime = 0;
        let lastFrameTime = Date.now();
        let bubbleIntervalId = null;
        
        const tank = document.getElementById('tank');
        const fishes = [];
        const pellets = [];
        const fallingCoins = [];
        const collectors = [];
        
        // Fish configurations
        const fishTypes = {
            small: {
                speed: 2,
                size: 30,
                hungerRate: 0.002,
                maxHunger: 100,
                starvationTime: 50000,
                coinValue: 5,
                coinInterval: 8000,
                isPredator: false
            },
            predator: {
                emoji: 'ü¶à',
                speed: 1.5,
                size: 50,
                hungerRate: 0.001,
                maxHunger: 100,
                starvationTime: 100000,
                coinValue: 50,
                coinInterval: 0,
                isPredator: true,
                huntCooldown: 5000
            },
            crab: {
                emoji: 'ü¶Ä',
                speed: 0.8,
                size: 28,
                isCrab: true,
                collectRadius: 50
            },
            jellyfish: {
                emoji: 'ü™º',
                speed: 1.2,
                size: 32,
                isJellyfish: true,
                collectRadius: 80
            }
        };
        
        // Pause/Resume
        function togglePause() {
            isPaused = !isPaused;
            document.getElementById('pauseBtn').textContent = isPaused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
            
            if (!isPaused) {
                lastFrameTime = Date.now();
            }
        }
        
        // Background modal
        function openBgModal() {
            document.getElementById('bgModal').style.display = 'block';
        }
        
        function closeBgModal() {
            document.getElementById('bgModal').style.display = 'none';
        }
        
        function setBackground(url) {
            if (url === 'default') {
                tank.style.backgroundImage = 'none';
                tank.style.background = 'linear-gradient(to bottom, #1a4d6d, #0a2a3d)';
            } else {
                tank.style.backgroundImage = `url('${url}')`;
            }
            closeBgModal();
        }
        
        function uploadBackground(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    tank.style.backgroundImage = `url('${e.target.result}')`;
                    closeBgModal();
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Fish selection modal
        function showFishSelect() {
            if (coins >= 20) {
                document.getElementById('fishSelectModal').style.display = 'block';
                updateModalCoins();
            } else {
                const shopBtn = document.getElementById('buySmallFishBtn');
                const originalText = shopBtn.textContent;
                shopBtn.textContent = "Need more üí∞!";
                shopBtn.style.background = 'linear-gradient(to bottom, #e24a4a, #9e2a2a)';
                setTimeout(() => {
                    shopBtn.textContent = originalText;
                    shopBtn.style.background = 'linear-gradient(to bottom, #4a90e2, #2a5f9e)';
                }, 1000);
            }
        }
        
        function closeFishSelect() {
            document.getElementById('fishSelectModal').style.display = 'none';
        }
        
        function updateModalCoins() {
            document.getElementById('modalCoins').textContent = coins;
        }
        
        function selectFish(emoji) {
            if (coins >= 20) {
                selectedFishEmoji = emoji;
                coins -= 20;
                playSound('buy');
                createFish('small', fishTypes.small);
                updateHUD();
                updateModalCoins();
                
                // Visual feedback
                event.target.style.transform = 'scale(1.3)';
                setTimeout(() => {
                    if (event.target) event.target.style.transform = '';
                }, 200);
            } else {
                const modal = document.getElementById('fishSelectModal');
                modal.style.borderColor = '#ff4444';
                setTimeout(() => {
                    modal.style.borderColor = '#5aa3ff';
                }, 300);
            }
        }
        
        // Create decorative bubbles
        function createBubbles() {
            function spawnBubble() {
                if (isPaused) return;
                if (Math.random() > 0.7) {
                    const bubble = document.createElement('div');
                    bubble.className = 'bubble';
                    const size = Math.random() * 20 + 10;
                    bubble.style.width = size + 'px';
                    bubble.style.height = size + 'px';
                    bubble.style.left = Math.random() * 100 + '%';
                    bubble.style.bottom = '0px';
                    tank.appendChild(bubble);
                    
                    const duration = Math.random() * 3000 + 4000;
                    const animation = bubble.animate([
                        { transform: 'translateY(0)', opacity: 0.7 },
                        { transform: `translateY(-${tank.offsetHeight}px)`, opacity: 0 }
                    ], { duration, easing: 'linear' });
                    
                    animation.onfinish = () => bubble.remove();
                    
                    if (isPaused) {
                        animation.pause();
                    }
                }
            }
            
            bubbleIntervalId = setInterval(spawnBubble, 500);
        }
        
        // Drop food pellet
        tank.addEventListener('click', (e) => {
            if (isPaused) return;
            if (food <= 0) {
                showMessage("Out of food!", e.offsetX, e.offsetY);
                return;
            }
            
            food--;
            updateHUD();
            playSound('food');
            
            const pellet = {
                id: pelletId++,
                x: e.offsetX,
                y: e.offsetY,
                element: document.createElement('div')
            };
            
            pellet.element.className = 'pellet';
            pellet.element.style.left = pellet.x + 'px';
            pellet.element.style.top = pellet.y + 'px';
            tank.appendChild(pellet.element);
            pellets.push(pellet);
        });
        
        // Buy food
        function buyFood() {
            if (coins >= 10) {
                coins -= 10;
                food += 5;
                playSound('buy');
                updateHUD();
            }
        }
        
        // Buy fish
        function buyFish(type) {
            const config = fishTypes[type];
            const cost = type === 'small' ? 20 : 100;
            
            if (coins >= cost) {
                coins -= cost;
                playSound('buy');
                createFish(type, config);
                updateHUD();
            }
        }
        
        // Buy collector
        function buyCollector(type) {
            const cost = type === 'crab' ? 150 : 250;
            
            if (coins >= cost) {
                coins -= cost;
                playSound('buy');
                createCollector(type);
                updateHUD();
            }
        }
        
        // Create a fish
        function createFish(type, config) {
            const fish = {
                id: fishId++,
                type: type,
                x: Math.random() * (tank.offsetWidth - 50),
                y: Math.random() * (tank.offsetHeight - 50),
                vx: (Math.random() - 0.5) * config.speed,
                vy: (Math.random() - 0.5) * config.speed,
                hunger: config.maxHunger,
                lastFeedTime: gameTime,
                config: config,
                element: document.createElement('div'),
                lastCoinTime: gameTime,
                lastHuntTime: gameTime
            };
            
            fish.element.className = 'fish';
            fish.element.textContent = type === 'small' ? selectedFishEmoji : config.emoji;
            fish.element.style.fontSize = config.size + 'px';
            fish.element.style.left = fish.x + 'px';
            fish.element.style.top = fish.y + 'px';
            tank.appendChild(fish.element);
            fishes.push(fish);
        }
        
        // Create collector (crab or jellyfish)
        function createCollector(type) {
            const config = fishTypes[type];
            const collector = {
                id: fishId++,
                type: type,
                x: type === 'crab' ? Math.random() * (tank.offsetWidth - 50) : Math.random() * (tank.offsetWidth - 50),
                y: type === 'crab' ? tank.offsetHeight - 40 : Math.random() * (tank.offsetHeight - 50),
                vx: (Math.random() - 0.5) * config.speed,
                vy: type === 'crab' ? 0 : (Math.random() - 0.5) * config.speed,
                config: config,
                element: document.createElement('div')
            };
            
            collector.element.className = type;
            collector.element.textContent = config.emoji;
            collector.element.style.fontSize = config.size + 'px';
            collector.element.style.left = collector.x + 'px';
            collector.element.style.top = collector.y + 'px';
            tank.appendChild(collector.element);
            collectors.push(collector);
        }
        
        // Show temporary message
        function showMessage(text, x, y) {
            const msg = document.createElement('div');
            msg.className = 'death-msg';
            msg.textContent = text;
            msg.style.left = x + 'px';
            msg.style.top = y + 'px';
            tank.appendChild(msg);
            setTimeout(() => msg.remove(), 1000);
        }
        
        // Drop coin or diamond from fish
        function dropCoin(fish, isDiamond = false) {
            const coin = {
                id: coinId++,
                x: fish.x + fish.config.size / 2,
                y: fish.y,
                value: isDiamond ? 50 : fish.config.coinValue,
                isDiamond: isDiamond,
                element: document.createElement('div')
            };
            
            coin.element.className = isDiamond ? 'diamond' : 'coin';
            coin.element.textContent = isDiamond ? 'üíé' : 'ü™ô';
            coin.element.style.left = coin.x + 'px';
            coin.element.style.top = coin.y + 'px';
            coin.element.style.padding = '10px';
            coin.element.onclick = () => collectCoin(coin);
            tank.appendChild(coin.element);
            fallingCoins.push(coin);
        }
        
        function collectCoin(coin) {
            coins += coin.value;
            playSound('collect');
            coin.element.remove();
            const index = fallingCoins.indexOf(coin);
            if (index > -1) fallingCoins.splice(index, 1);
            updateHUD();
        }
        
        // Update HUD
        function updateHUD() {
            document.getElementById('coins').textContent = coins;
            document.getElementById('fishCount').textContent = fishes.length;
            document.getElementById('foodCount').textContent = food;
            
            document.getElementById('buyFoodBtn').disabled = coins < 10;
            document.getElementById('buySmallFishBtn').disabled = coins < 20;
            document.getElementById('buyPredatorBtn').disabled = coins < 100;
            document.getElementById('buyCrabBtn').disabled = coins < 150;
            document.getElementById('buyJellyfishBtn').disabled = coins < 250;
        }
        
        // Main game loop
        function gameLoop() {
            if (isPaused) {
                requestAnimationFrame(gameLoop);
                return;
            }
            
            // Calculate delta time
            const currentTime = Date.now();
            const deltaTime = currentTime - lastFrameTime;
            lastFrameTime = currentTime;
            gameTime += deltaTime;
            
            const tankWidth = tank.offsetWidth;
            const tankHeight = tank.offsetHeight;
            
            // Update pellets (make them fall)
            pellets.forEach((pellet, index) => {
                pellet.y += 1.5;
                pellet.element.style.top = pellet.y + 'px';
                
                if (pellet.y > tankHeight) {
                    pellet.element.remove();
                    pellets.splice(index, 1);
                }
            });
            
            // Update falling coins and diamonds
            fallingCoins.forEach((coin, index) => {
                coin.y += 0.8;
                coin.element.style.top = coin.y + 'px';
                
                if (coin.y > tankHeight - 10) {
                    coin.element.style.top = (tankHeight - 10) + 'px';
                }
            });
            
            // Update collectors (crabs and jellyfish)
            collectors.forEach((collector) => {
                // Seek nearest coin/diamond
                let targetCoin = null;
                let closestDist = Infinity;
                
                fallingCoins.forEach(coin => {
                    const dx = coin.x - collector.x;
                    const dy = coin.y - collector.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist < closestDist) {
                        closestDist = dist;
                        targetCoin = coin;
                    }
                });
                
                if (targetCoin && closestDist < 300) {
                    const dx = targetCoin.x - collector.x;
                    const dy = targetCoin.y - collector.y;
                    const angle = Math.atan2(dy, dx);
                    
                    if (collector.config.isCrab) {
                        collector.vx = Math.cos(angle) * collector.config.speed;
                        collector.y = tankHeight - 40;
                    } else {
                        collector.vx = Math.cos(angle) * collector.config.speed;
                        collector.vy = Math.sin(angle) * collector.config.speed;
                    }
                    
                    if (closestDist < collector.config.collectRadius) {
                        collectCoin(targetCoin);
                    }
                }
                
                // Move collector
                collector.x += collector.vx;
                if (!collector.config.isCrab) {
                    collector.y += collector.vy;
                }
                
                // Bounce off walls
                if (collector.x < 0 || collector.x > tankWidth - collector.config.size) {
                    collector.vx *= -1;
                    collector.x = Math.max(0, Math.min(tankWidth - collector.config.size, collector.x));
                }
                
                if (!collector.config.isCrab) {
                    if (collector.y < 0 || collector.y > tankHeight - collector.config.size) {
                        collector.vy *= -1;
                        collector.y = Math.max(0, Math.min(tankHeight - collector.config.size, collector.y));
                    }
                }
                
                // Random direction changes
                if (Math.random() < 0.01) {
                    collector.vx += (Math.random() - 0.5) * 0.3;
                    if (!collector.config.isCrab) {
                        collector.vy += (Math.random() - 0.5) * 0.3;
                    }
                }
                
                // Flip based on direction
                collector.element.style.transform = collector.vx < 0 ? 'scaleX(-1)' : 'scaleX(1)';
                
                // Update position
                collector.element.style.left = collector.x + 'px';
                collector.element.style.top = collector.y + 'px';
            });
            
            // Update fish
            fishes.forEach((fish, fishIndex) => {
                // Hunger decreases over time
                fish.hunger -= fish.config.hungerRate;
                
                // Check starvation using gameTime
                const timeSinceLastFeed = gameTime - fish.lastFeedTime;
                if (fish.hunger <= 0 || timeSinceLastFeed > fish.config.starvationTime) {
                    showMessage("üíÄ Starved!", fish.x, fish.y);
                    playSound('death');
                    fish.element.remove();
                    fishes.splice(fishIndex, 1);
                    updateHUD();
                    return;
                }
                
                // Predator hunting behavior
                if (fish.config.isPredator && gameTime - fish.lastHuntTime > fish.config.huntCooldown) {
                    let closestPrey = null;
                    let closestDist = Infinity;
                    
                    fishes.forEach(otherFish => {
                        if (otherFish.id !== fish.id && !otherFish.config.isPredator) {
                            const dx = otherFish.x - fish.x;
                            const dy = otherFish.y - fish.y;
                            const dist = Math.sqrt(dx * dx + dy * dy);
                            
                            if (dist < closestDist && dist < 200) {
                                closestDist = dist;
                                closestPrey = otherFish;
                            }
                        }
                    });
                    
                    if (closestPrey) {
                        const dx = closestPrey.x - fish.x;
                        const dy = closestPrey.y - fish.y;
                        const angle = Math.atan2(dy, dx);
                        fish.vx = Math.cos(angle) * fish.config.speed * 2;
                        fish.vy = Math.sin(angle) * fish.config.speed * 2;
                        
                        // Check for successful hunt
                        if (closestDist < 40) {
                            showMessage("ü¶à CHOMP!", closestPrey.x, closestPrey.y);
                            playSound('death');
                            const preyIndex = fishes.indexOf(closestPrey);
                            closestPrey.element.remove();
                            fishes.splice(preyIndex, 1);
                            fish.hunger = Math.min(fish.config.maxHunger, fish.hunger + 30);
                            fish.lastFeedTime = gameTime;
                            fish.lastHuntTime = gameTime;
                            
                            dropCoin(fish, true);
                            
                            updateHUD();
                        }
                    }
                }
                
                // Normal fish: seek food pellets
                if (!fish.config.isPredator) {
                    let targetPellet = null;
                    let closestDist = Infinity;
                    
                    pellets.forEach(pellet => {
                        const dx = pellet.x - fish.x;
                        const dy = pellet.y - fish.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        
                        if (dist < closestDist && dist < 150) {
                            closestDist = dist;
                            targetPellet = pellet;
                        }
                    });
                    
                    if (targetPellet) {
                        const dx = targetPellet.x - fish.x;
                        const dy = targetPellet.y - fish.y;
                        const angle = Math.atan2(dy, dx);
                        fish.vx = Math.cos(angle) * fish.config.speed * 1.5;
                        fish.vy = Math.sin(angle) * fish.config.speed * 1.5;
                        
                        // Eat pellet
                        if (closestDist < 20) {
                            fish.hunger = Math.min(fish.config.maxHunger, fish.hunger + 20);
                            fish.lastFeedTime = gameTime;
                            targetPellet.element.remove();
                            const pelletIndex = pellets.indexOf(targetPellet);
                            pellets.splice(pelletIndex, 1);
                        }
                    }
                }
                
                // Move fish
                fish.x += fish.vx;
                fish.y += fish.vy;
                
                // Bounce off walls
                if (fish.x < 0 || fish.x > tankWidth - fish.config.size) {
                    fish.vx *= -1;
                    fish.x = Math.max(0, Math.min(tankWidth - fish.config.size, fish.x));
                }
                if (fish.y < 0 || fish.y > tankHeight - fish.config.size) {
                    fish.vy *= -1;
                    fish.y = Math.max(0, Math.min(tankHeight - fish.config.size, fish.y));
                }
                
                // Random direction changes
                if (Math.random() < 0.02) {
                    fish.vx += (Math.random() - 0.5) * 0.5;
                    fish.vy += (Math.random() - 0.5) * 0.5;
                    
                    const speed = Math.sqrt(fish.vx * fish.vx + fish.vy * fish.vy);
                    const maxSpeed = fish.config.speed;
                    if (speed > maxSpeed) {
                        fish.vx = (fish.vx / speed) * maxSpeed;
                        fish.vy = (fish.vy / speed) * maxSpeed;
                    }
                }
                
                // Flip fish based on direction
                fish.element.style.transform = fish.vx < 0 ? 'scaleX(-1)' : 'scaleX(1)';
                
                // Update position
                fish.element.style.left = fish.x + 'px';
                fish.element.style.top = fish.y + 'px';
                
                // Drop coins periodically (if not a predator and well-fed)
                if (!fish.config.isPredator && 
                    fish.hunger > 50 && 
                    gameTime - fish.lastCoinTime > fish.config.coinInterval) {
                    dropCoin(fish, false);
                    fish.lastCoinTime = gameTime;
                }
                
                // Visual hunger indicator (opacity)
                fish.element.style.opacity = 0.4 + (fish.hunger / fish.config.maxHunger) * 0.6;
            });
            
            requestAnimationFrame(gameLoop);
        }
        
        // Initialize game
        createBubbles();
        updateHUD();
        
        // Start with a couple fish
        createFish('small', fishTypes.small);
        createFish('small', fishTypes.small);
        
        gameLoop();
        
        // Resume audio context on first user interaction
        document.addEventListener('click', () => {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }, { once: true });
        
        // Pro tips
        setTimeout(() => {
            console.log("üéÆ PRO TIPS:");
            console.log("‚Ä¢ Click to drop food (duh)");
            console.log("‚Ä¢ Fish drop ü™ô coins when happy (hunger > 50%)");
            console.log("‚Ä¢ Starving fish = dead fish = your fault");
            console.log("‚Ä¢ Predators eat smaller fish and drop üíé diamonds worth 50!");
            console.log("‚Ä¢ Watch fish fade when hungry (it's your warning)");
            console.log("‚Ä¢ Crabs ü¶Ä crawl on the bottom collecting coins");
            console.log("‚Ä¢ Jellyfish ü™º swim around collecting coins and diamonds");
            console.log("‚Ä¢ Choose from 3 fish types: üêüüê†üê°");
            console.log("‚Ä¢ Use pause ‚è∏Ô∏è button when you need a break");
            console.log("‚Ä¢ Change background üñºÔ∏è with preset images or upload your own!");
            console.log("‚Ä¢ Fish modal stays open - buy as many as you want!");
            console.log("‚Ä¢ Now stop reading and start clicking!");
        }, 1000);
    </script>
</body>
</html>
