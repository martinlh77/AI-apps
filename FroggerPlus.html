<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Emoji Frogger: Rainbow Edition</title>
    <style>
        body {
            margin: 0; padding: 0; background: #111;
            font-family: 'Segoe UI', Arial, sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; color: white; touch-action: none; overflow: hidden;
        }

        #game-container {
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
            border: 4px solid #444; background: #000;
        }

        canvas { display: block; max-width: 95vw; max-height: 70vh; }

        .stats-bar {
            position: absolute; top: -55px; width: 100%;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: bold; font-size: 20px; color: #4CAF50;
        }

        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; background: rgba(0,0,0,0.94);
            text-align: center; padding: 20px; box-sizing: border-box; z-index: 10;
        }

        .hidden { display: none !important; }

        h1 { margin: 0 0 10px 0; color: #4CAF50; font-size: 2rem; }
        p { font-size: 14px; margin: 4px 0; color: #ccc; }

        .menu-section {
            background: rgba(255,255,255,0.05);
            padding: 12px; border-radius: 10px; margin: 8px 0; width: 90%;
        }

        .customizer {
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            margin: 10px 0; background: rgba(76, 175, 80, 0.1); padding: 10px; border-radius: 8px;
        }

        #color-preview { font-size: 40px; }

        button {
            padding: 12px 20px; font-size: 16px; background: #4CAF50;
            border: none; color: white; border-radius: 5px;
            cursor: pointer; margin: 5px; font-weight: bold;
            box-shadow: 0 4px #2d5a27;
        }

        button.secondary { background: #2196F3; box-shadow: 0 4px #0d47a1; }
        
        select, input[type=range] { cursor: pointer; }

        .bug-info { display: flex; gap: 15px; justify-content: center; margin: 5px 0; font-size: 13px; }
        .row-flex { display: flex; align-items: center; gap: 10px; }
    </style>
</head>
<body>

    <div id="game-container">
        <div class="stats-bar">
            <div id="score-display">0000</div>
            <div id="timer-display" style="color: #ffeb3b;"></div>
            <div id="lives-display">üê∏üê∏üê∏</div>
        </div>
        
        <canvas id="gameCanvas"></canvas>

        <div id="ui-layer">
            <h1 id="ui-title">EMOJI FROGGER</h1>
            
            <div class="menu-section">
                <p><b>FROG CUSTOMIZER:</b></p>
                <div class="customizer">
                    <div id="color-preview">üê∏</div>
                    <div class="row-flex">
                        <label>Hue:</label>
                        <input type="range" id="hue-slider" min="0" max="360" value="0">
                    </div>
                    <div class="row-flex">
                        <input type="checkbox" id="random-color-toggle">
                        <label for="random-color-toggle">Randomize color each frog</label>
                    </div>
                </div>
            </div>

            <div class="menu-section">
                <button id="start-standard">STANDARD MODE</button>
                <div style="margin: 10px 0; border-top: 1px solid #444; padding-top: 10px;">
                    <button id="start-challenge" class="secondary">CHALLENGE MODE</button>
                    <select id="time-select" style="padding:10px; border-radius:5px;">
                        <option value="30">30 Sec</option>
                        <option value="45">45 Sec</option>
                        <option value="60">1 Min</option>
                        <option value="120">2 Mins</option>
                        <option value="180">3 Mins</option>
                        <option value="240">4 Mins</option>
                        <option value="300">5 Mins</option>
                    </select>
                </div>
            </div>

            <div class="bug-info">
                <div>ü™≤ +150 Pts</div>
                <div>‚ú® Invincible</div>
            </div>
        </div>
    </div>

<script>
/** AUDIO ENGINE **/
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(freq, type, duration, vol = 0.1) {
    try {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        osc.connect(gain); gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    } catch(e){}
}
const sfx = {
    hop: () => playSound(450, 'sine', 0.1),
    hit: () => playSound(100, 'sawtooth', 0.4),
    win: () => { playSound(500, 'sine', 0.1); setTimeout(()=>playSound(850, 'sine', 0.2), 100); },
    bug: () => playSound(950, 'triangle', 0.2),
    power: () => playSound(1200, 'square', 0.5, 0.05),
    life: () => playSound(1500, 'sine', 0.6)
};

/** GLOBALS **/
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const GRID = 48; const COLS = 11; const ROWS = 13;
canvas.width = COLS * GRID; canvas.height = ROWS * GRID;

let score = 0, lives = 3, totalSaved = 0, level = 1, lastLifeScore = 0;
let gameActive = false, isChallenge = false, timeLeft = 0;

const frog = { 
    x: 5, y: 12, 
    isGhost: false, timer: 0, 
    hue: 0,
    isRandomHue: false
};

const layout = [3, 2, 2, 2, 2, 2, 0, 1, 1, 1, 1, 1, 0];
const pads = [1, 3, 5, 7, 9];
let obstacles = [], bugs = [];

// Customizer UI Logic
const hueSlider = document.getElementById('hue-slider');
const randomToggle = document.getElementById('random-color-toggle');
const colorPreview = document.getElementById('color-preview');

hueSlider.addEventListener('input', () => {
    if(!randomToggle.checked) {
        frog.hue = hueSlider.value;
        colorPreview.style.filter = `hue-rotate(${frog.hue}deg)`;
    }
});

randomToggle.addEventListener('change', () => {
    hueSlider.disabled = randomToggle.checked;
    colorPreview.innerText = randomToggle.checked ? 'üåà' : 'üê∏';
    if(!randomToggle.checked) {
        frog.hue = hueSlider.value;
        colorPreview.style.filter = `hue-rotate(${frog.hue}deg)`;
    } else {
        colorPreview.style.filter = 'none';
    }
});

class Obstacle {
    constructor(row, type, speed, emoji, width = 1) {
        this.row = row; this.type = type; this.speed = speed; this.emoji = emoji; this.width = width;
        this.x = Math.random() * COLS;
    }
    update(dt) {
        this.x += this.speed * dt;
        if (this.speed > 0 && this.x > COLS) this.x = -this.width;
        if (this.speed < 0 && this.x < -this.width) this.x = COLS;
    }
    draw() {
        ctx.save(); ctx.font = `${GRID * 0.85}px Arial`;
        for (let i = 0; i < this.width; i++) {
            const bx = (this.x + i) * GRID; const by = (this.row + 0.82) * GRID;
            if (this.type === 'car' && this.speed > 0) {
                ctx.save(); ctx.translate(bx + GRID/2, by - GRID/2.5); ctx.scale(-1, 1);
                ctx.fillText(this.emoji, -GRID/2, GRID/2.5); ctx.restore();
            } else ctx.fillText(this.emoji, bx, by);
        }
        ctx.restore();
    }
}

class Bug {
    constructor() {
        this.row = Math.floor(Math.random() * 10) + 1;
        this.x = Math.floor(Math.random() * COLS);
        this.isGold = Math.random() > 0.8;
        this.emoji = this.isGold ? '‚ú®' : 'ü™≤'; this.ttl = 500;
    }
    draw() {
        ctx.save();
        ctx.globalAlpha = this.ttl < 100 ? 0.4 : 1;
        ctx.font = `${GRID * 0.7}px Arial`;
        ctx.fillText(this.emoji, this.x * GRID + (GRID*0.15), (this.row + 0.75) * GRID);
        ctx.restore();
    }
}

function initLevel() {
    obstacles = [];
    const s = 1 + (level - 1) * 0.12; 
    obstacles.push(new Obstacle(11, 'car', 1.8 * s, 'üèéÔ∏è'), new Obstacle(11, 'car', 1.8 * s, 'üèéÔ∏è'));
    obstacles.push(new Obstacle(10, 'car', -1.3 * s, 'üöï'), new Obstacle(10, 'car', -1.3 * s, 'üöï'));
    obstacles.push(new Obstacle(9, 'car', 2.1 * s, 'üöö', 2), new Obstacle(8, 'car', -1.8 * s, 'üöì'));
    obstacles.push(new Obstacle(7, 'car', 1.5 * s, 'üö≤'));
    obstacles.push(new Obstacle(5, 'log', 1.4 * s, 'ü™µ', 3), new Obstacle(5, 'log', 1.4 * s, 'ü™µ', 3));
    obstacles.push(new Obstacle(4, 'log', -1.6 * s, 'ü™µ', 2), new Obstacle(4, 'log', -1.6 * s, 'ü™µ', 2));
    obstacles.push(new Obstacle(3, 'log', 2.4 * s, 'ü™µ', 4), new Obstacle(2, 'log', -1.2 * s, 'ü™µ', 3));
    obstacles.push(new Obstacle(1, 'log', 1.5 * s, 'ü™µ', 2));
}

function die() {
    if (frog.isGhost) return;
    lives--; sfx.hit(); updateUI();
    if (lives <= 0 && !isChallenge) endGame("GAME OVER");
    else resetFrog();
}

function resetFrog() { 
    frog.x = 5; frog.y = 12; 
    if(randomToggle.checked) {
        frog.hue = Math.floor(Math.random() * 360);
    }
}

function updateUI() {
    document.getElementById('score-display').innerText = `PTS: ${score}`;
    document.getElementById('lives-display').innerText = isChallenge ? `SAVED: ${totalSaved}` : 'üê∏'.repeat(Math.max(0, lives));
    if (isChallenge) {
        const m = Math.floor(timeLeft / 60); const s = Math.floor(timeLeft % 60);
        document.getElementById('timer-display').innerText = `${m}:${s.toString().padStart(2, '0')}`;
    } else document.getElementById('timer-display').innerText = "";
}

function endGame(title) {
    gameActive = false;
    document.getElementById('ui-layer').classList.remove('hidden');
    document.getElementById('ui-title').innerText = title;
}

function moveFrog(dx, dy) {
    if (!gameActive) return;
    let nx = Math.round(frog.x + dx), ny = frog.y + dy;
    if (nx >= 0 && nx < COLS && ny < ROWS && ny >= 0) {
        if (ny === 0) {
            if (pads.includes(nx)) {
                totalSaved++; score += 500; sfx.win();
                if (totalSaved % 4 === 0) { level++; initLevel(); }
                resetFrog(); updateUI(); return;
            } else return;
        }
        frog.x = nx; frog.y = ny; sfx.hop();
        if (dy < 0) score += 10;
        updateUI();
    }
}

/** INPUTS **/
window.addEventListener('keydown', e => {
    if (e.key === 'ArrowUp') moveFrog(0, -1);
    if (e.key === 'ArrowDown') moveFrog(0, 1);
    if (e.key === 'ArrowLeft') moveFrog(-1, 0);
    if (e.key === 'ArrowRight') moveFrog(1, 0);
});

let tsX = 0, tsY = 0;
window.addEventListener('touchstart', e => { tsX = e.touches[0].clientX; tsY = e.touches[0].clientY; }, {passive: false});
window.addEventListener('touchend', e => {
    let dx = e.changedTouches[0].clientX - tsX, dy = e.changedTouches[0].clientY - tsY;
    if (Math.abs(dx) > 25 || Math.abs(dy) > 25) {
        if (Math.abs(dx) > Math.abs(dy)) moveFrog(dx > 0 ? 1 : -1, 0);
        else moveFrog(0, dy > 0 ? 1 : -1);
    }
}, {passive: false});

/** LOOP **/
function draw() {
    if (gameActive) {
        const dt = 1/60;
        if (isChallenge) { timeLeft -= dt; if (timeLeft <= 0) endGame("TIME'S UP!"); }
        else { if (score >= lastLifeScore + 3000) { lives++; lastLifeScore += 3000; sfx.life(); updateUI(); } }
        
        obstacles.forEach(o => o.update(dt));
        if (frog.isGhost) { frog.timer--; if (frog.timer <= 0) frog.isGhost = false; }

        if (layout[frog.y] === 2) { 
            let onLog = false;
            obstacles.forEach(o => {
                if (o.row === frog.y) {
                    if (frog.x > o.x - 0.75 && frog.x < o.x + o.width - 0.25) {
                        onLog = true; frog.x += o.speed * dt;
                    }
                }
            });
            if (!onLog && !frog.isGhost) die();
            if (frog.x < -0.8 || frog.x > COLS - 0.2) die();
        } else if (layout[frog.y] === 1 && !frog.isGhost) {
            obstacles.forEach(o => { if (o.row === frog.y && Math.abs(frog.x - o.x) < 0.7) die(); });
        }

        if (Math.random() < 0.005 && bugs.length < 2) bugs.push(new Bug());
        bugs.forEach((b, i) => {
            b.ttl--;
            if (b.ttl <= 0) bugs.splice(i, 1);
            else if (b.row === frog.y && Math.abs(frog.x - b.x) < 0.7) {
                if (b.isGold) { frog.isGhost = true; frog.timer = 400; sfx.power(); }
                else { score += 150; sfx.bug(); }
                bugs.splice(i, 1); updateUI();
            }
        });
        updateUI();
    }

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    layout.forEach((type, i) => {
        ctx.fillStyle = type === 0 ? '#2d5a27' : type === 1 ? '#222' : type === 2 ? '#005c99' : '#1a3c15';
        ctx.fillRect(0, i * GRID, canvas.width, GRID);
    });
    pads.forEach(lx => {
        ctx.fillStyle = '#002200'; ctx.fillRect(lx * GRID + 4, 4, GRID - 8, GRID - 8);
        ctx.font = `${GRID * 0.7}px Arial`; ctx.fillText('ü™∑', lx * GRID + (GRID*0.1), GRID * 0.75);
    });
    obstacles.forEach(o => o.draw()); bugs.forEach(b => b.draw());

    ctx.save();
    ctx.filter = `hue-rotate(${frog.hue}deg)`; 
    if (frog.isGhost) { 
        ctx.shadowBlur = 20; ctx.shadowColor = "white"; 
        ctx.globalAlpha = 0.7 + Math.sin(Date.now()/60)*0.3; 
    }
    ctx.font = `${GRID * 0.85}px Arial`; ctx.fillText('üê∏', frog.x * GRID, (frog.y + 0.82) * GRID);
    ctx.restore();
    
    requestAnimationFrame(draw);
}

/** START ACTIONS **/
function start(challenge) {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    score = 0; lives = 3; totalSaved = 0; level = 1; lastLifeScore = 0;
    isChallenge = challenge;
    timeLeft = parseInt(document.getElementById('time-select').value);
    
    frog.hue = randomToggle.checked ? Math.floor(Math.random() * 360) : hueSlider.value;
    
    resetFrog(); initLevel(); updateUI();
    gameActive = true;
    document.getElementById('ui-layer').classList.add('hidden');
}

document.getElementById('start-standard').onclick = () => start(false);
document.getElementById('start-challenge').onclick = () => start(true);

draw();
</script>
</body>
</html>
