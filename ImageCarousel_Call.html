<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Carousel - GitHub Hosted</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; transition: background-color 0.3s ease; }
        .carousel-image { object-fit: contain; transition: opacity 0.5s ease-in-out; background-color: #f0f0f0; }
        .dot { transition: background-color 0.3s ease; }
        .dot.active { background-color: #6366f1; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="relative w-full max-w-2xl bg-white shadow-xl rounded-2xl overflow-hidden">
        <div class="w-full h-80 sm:h-96 md:h-[28rem] lg:h-[32rem] flex items-center justify-center bg-gray-200 overflow-hidden rounded-t-2xl">
            <img id="carousel-image" src="" alt="Loading images..." class="carousel-image w-full h-full rounded-t-2xl">
        </div>

        <button id="prev-btn" class="absolute top-1/2 left-4 transform -translate-y-1/2 bg-gray-800 bg-opacity-70 text-white p-3 rounded-full shadow-lg hover:bg-opacity-90 focus:outline-none transition duration-300">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </button>
        <button id="next-btn" class="absolute top-1/2 right-4 transform -translate-y-1/2 bg-gray-800 bg-opacity-70 text-white p-3 rounded-full shadow-lg hover:bg-opacity-90 focus:outline-none transition duration-300">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
        </button>

        <div id="dot-indicators" class="flex justify-center p-4 space-x-2 bg-white"></div>

        <div class="flex justify-center p-4 space-x-4 bg-white rounded-b-2xl">
            <button id="toggle-autoplay-btn" class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition duration-300">Pause Autoplay</button>
            <button id="download-btn" class="px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition duration-300">View to Download</button>
        </div>
    </div>

    <script>
        // --- GITHUB CONFIGURATION ---
        // 1. Add a "Cache Buster" (a timestamp) so Google Sites doesn't show an old version
        const JSON_URL = "https://martinlh77.github.io/AI-apps/images.json?t=" + new Date().getTime();
        
        let images = []; 
        let currentIndex = 0;
        let autoplayInterval;
        let isAutoplayPaused = false;

        const carouselImage = document.getElementById('carousel-image');
        const dotIndicators = document.getElementById('dot-indicators');
        const toggleAutoplayBtn = document.getElementById('toggle-autoplay-btn');

        async function loadImages() {
            try {
                // 2. Add { cache: "no-store" } to the fetch request
                const response = await fetch(JSON_URL, { cache: "no-store" });
                
                if (!response.ok) throw new Error("Could not load image list");
                images = await response.json();
                
                if (images.length > 0) {
                    initCarousel();
                }
            } catch (error) {
                console.error("Error:", error);
                carouselImage.alt = "Error loading images from GitHub.";
            }
        }

        function initCarousel() {
            createDots();
            showImage(0);
            startAutoplay();
        }

        function showImage(index) {
            if (images.length === 0) return;
            if (index >= images.length) currentIndex = 0;
            else if (index < 0) currentIndex = images.length - 1;
            else currentIndex = index;

            carouselImage.src = images[currentIndex];
            updateDots();
        }

        function updateDots() {
            const dots = dotIndicators.children;
            for (let i = 0; i < dots.length; i++) {
                dots[i].classList.remove('active', 'bg-indigo-500');
                dots[i].classList.add('bg-gray-300');
            }
            if (dots[currentIndex]) {
                dots[currentIndex].classList.add('active', 'bg-indigo-500');
                dots[currentIndex].classList.remove('bg-gray-300');
            }
        }

        function createDots() {
            dotIndicators.innerHTML = '';
            images.forEach((_, index) => {
                const dot = document.createElement('span');
                dot.classList.add('dot', 'w-3', 'h-3', 'rounded-full', 'cursor-pointer', 'bg-gray-300', 'hover:bg-gray-400');
                dot.addEventListener('click', () => {
                    showImage(index);
                    pauseAutoplay();
                });
                dotIndicators.appendChild(dot);
            });
            updateDots();
        }

        function startAutoplay() {
            if (autoplayInterval) clearInterval(autoplayInterval);
            autoplayInterval = setInterval(() => { showImage(currentIndex + 1); }, 5000);
            toggleAutoplayBtn.textContent = 'Pause Autoplay';
            isAutoplayPaused = false;
        }

        function pauseAutoplay() {
            clearInterval(autoplayInterval);
            toggleAutoplayBtn.textContent = 'Play Autoplay';
            isAutoplayPaused = true;
        }

        document.getElementById('prev-btn').addEventListener('click', () => { showImage(currentIndex - 1); pauseAutoplay(); });
        document.getElementById('next-btn').addEventListener('click', () => { showImage(currentIndex + 1); pauseAutoplay(); });
        toggleAutoplayBtn.addEventListener('click', () => { isAutoplayPaused ? startAutoplay() : pauseAutoplay(); });
        document.getElementById('download-btn').addEventListener('click', () => { window.open(images[currentIndex], '_blank'); });

        // Initial Load
        document.addEventListener('DOMContentLoaded', loadImages);
    </script>
</body>
</html>
